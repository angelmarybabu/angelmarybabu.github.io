<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="layout-lang" content="en"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="How to install and configure Prometheus as well as Grafana for an EC2 instance?" /><meta name="author" content="Angel Mary Babu" /><meta property="og:locale" content="en" /><meta name="description" content="Install and configure Prometheus" /><meta property="og:description" content="Install and configure Prometheus" /><link rel="canonical" href="https://angelmarybabu.github.io/posts/Prometheus-Grafana/" /><meta property="og:url" content="https://angelmarybabu.github.io/posts/Prometheus-Grafana/" /><meta property="og:site_name" content="Angel Mary Babu" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-05-20T08:30:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to install and configure Prometheus as well as Grafana for an EC2 instance?" /><meta name="twitter:site" content="@AngelMaryBabu1" /><meta name="twitter:creator" content="@Angel Mary Babu" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Angel Mary Babu"},"dateModified":"2021-08-21T12:25:52+05:30","datePublished":"2020-05-20T08:30:00+05:30","description":"Install and configure Prometheus","headline":"How to install and configure Prometheus as well as Grafana for an EC2 instance?","mainEntityOfPage":{"@type":"WebPage","@id":"https://angelmarybabu.github.io/posts/Prometheus-Grafana/"},"url":"https://angelmarybabu.github.io/posts/Prometheus-Grafana/"}</script><title>How to install and configure Prometheus as well as Grafana for an EC2 instance? | Angel Mary Babu</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Angel Mary Babu"><meta name="application-name" content="Angel Mary Babu"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://raw.githubusercontent.com/angelmarybabu/angelmarybabu.github.io/master/assets/img/favicons/angel.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Angel Mary Babu</a></div><div class="site-subtitle font-italic">Cloud, DevOps, Site Reliability Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/angelmarybabu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/AngelMaryBabu1" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['angelmarybabu2','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to install and configure Prometheus as well as Grafana for an EC2 instance?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How to install and configure Prometheus as well as Grafana for an EC2 instance?</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Angel Mary Babu </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, May 20, 2020, 8:30 AM +0530" >May 20, 2020<i class="unloaded">2020-05-20T08:30:00+05:30</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 21, 2021, 12:25 PM +0530" >Aug 21, 2021<i class="unloaded">2021-08-21T12:25:52+05:30</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1193 words">6 min read</span></div></div><div class="post-content"><p>Prometheus is one of the widely accepted open source monitoring tools and it takes metrics from the client machine using the node exporter. It displays them using Grafana which gives more visibility and customization..</p><h2 id="installation">Installation</h2><p>Now we have a basic understanding of Prometheus and Grafana. So let’s start to set up in an EC2 instance. Here I am taking an Ubuntu 20 server as a log server.</p><h5 id="node-exporter">Node Exporter</h5><p>We have to install node exporter on our host machines and it can be download using the following steps;</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://github.com/prometheus/node_exporter/releases/download/v0.15.2/node_exporter-0.15.2.linux-amd64.tar.gz
</pre></table></code></div></div><p>Extract the downloaded archive</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tar</span> <span class="nt">-xf</span> node_exporter-0.15.2.linux-amd64.tar.gz
</pre></table></code></div></div><p>Move the node_exporter binary to /usr/local/bin:</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo mv </span>node_exporter-0.15.2.linux-amd64/node_exporter /usr/local/bin
</pre></table></code></div></div><p>Remove the archive file</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">rm</span> <span class="nt">-r</span> node_exporter-0.15.2.linux-amd64.tar.gz
</pre></table></code></div></div><p>We will create users and service files for node_exporter.</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>useradd <span class="nt">-rs</span> /bin/false node_exporter
</pre></table></code></div></div><p>Then, we will create a systemd unit file so that node_exporter can be started at boot.</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>vi /etc/systemd/system/node_exporter.service
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Node Exporter
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service]
<span class="nv">User</span><span class="o">=</span>node_exporter
<span class="nv">Group</span><span class="o">=</span>node_exporter
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/node_exporter

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></table></code></div></div><p>Now we can restart and reload the service,</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>node_exporter
<span class="nb">sudo </span>systemctl start node_exporter
</pre></table></code></div></div><h5 id="prometheus-in-the-log-server">Prometheus in the log server,</h5><p>Download in a directory of your server with the following command,</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://github.com/prometheus/prometheus/releases/download/v2.1.0/prometheus-2.1.0.linux-amd64.tar.gz
</pre></table></code></div></div><p>Extract it.</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tar</span> <span class="nt">-xf</span> prometheus-2.1.0.linux-amd64.tar.gz
</pre></table></code></div></div><p>Let’s move the binaries to /usr/local/bin:</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo mv </span>prometheus-2.1.0.linux-amd64/prometheus prometheus-2.1.0.linux-amd64/promtool /usr/local/bin
</pre></table></code></div></div><p>Now, we are going to create directories for configuration files and other prometheus data.</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo mkdir</span> /etc/prometheus /var/lib/prometheus
</pre></table></code></div></div><p>Then, we have to move the configuration files to the directory from the present directory to the created directories</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo mv </span>prometheus-2.1.0.linux-amd64/consoles prometheus-2.1.0.linux-amd64/console_libraries /etc/prometheus
</pre></table></code></div></div><p>Now, we can remove the archive file which we no longer needed.</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">rm</span> <span class="nt">-r</span> prometheus-2.1.0.linux-amd64.tar.gz
</pre></table></code></div></div><h5 id="configuring-prometheus">Configuring Prometheus</h5><p>Once we have installed Prometheus, we have to configure Prometheus to let it know about the HTTP endpoints it should monitor. Now we are going to add our client machine IPs in <code class="language-plaintext highlighter-rouge">/etc/hosts</code> using the following format;</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>x.x.x.x host-machine-1
x.x.x.x host-machine-2
</pre></table></code></div></div><p>Now we will configure the configuration file <code class="language-plaintext highlighter-rouge">/etc/prometheus/prometheus.yml</code> as following,</p><div lang="sh" class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>global:
  scrape_interval: 10s

scrape_configs:
  - job_name: <span class="s1">'prometheus_metrics'</span>
    scrape_interval: 5s
    static_configs:
      - targets: <span class="o">[</span><span class="s1">'localhost:9090'</span><span class="o">]</span>
  - job_name: <span class="s1">'node_exporter_metrics'</span>
    scrape_interval: 5s
    static_configs:
      - targets: <span class="o">[</span><span class="s1">'localhost:9100'</span>,<span class="s1">'host-machine-1:9100'</span>,<span class="s1">'host-machine-2:9100'</span><span class="o">]</span>
</pre></table></code></div></div><p>Here we have to create the necessary users and permission for the Prometheus user,</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo useradd -rs /bin/false prometheus
sudo chown -R prometheus: /etc/prometheus /var/lib/prometheus
</pre></table></code></div></div><p>Also, we will create a systemd unit file in <code class="language-plaintext highlighter-rouge">/etc/systemd/system/prometheus.service</code> with the following contents :</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>[Unit]
Description=Prometheus
After=network.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/ \
    --web.console.templates=/etc/prometheus/consoles \
    --web.console.libraries=/etc/prometheus/console_libraries

[Install]
WantedBy=multi-user.target
</pre></table></code></div></div><p>Last, we have to reload and start the services to make the changes in effect,</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl start prometheus
</pre></table></code></div></div><p>Now the prometheus web UI can be accessed using the following URLt <code class="language-plaintext highlighter-rouge">http://&lt;your_server_IP&gt;:9090/</code></p><h5 id="grafana">Grafana</h5><p>First, Install Grafana on our log instance.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>wget https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana_5.0.4_amd64.deb
sudo apt-get install -y adduser libfontconfig
sudo dpkg -i grafana_5.0.4_amd64.deb
</pre></table></code></div></div><p>Now, enable and automatic restart on boot,</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo systemctl daemon-reload &amp;&amp; sudo systemctl enable grafana-server &amp;&amp; sudo systemctl start grafana-server.service
</pre></table></code></div></div><p>Grafana is running now, and we can connect to it at <code class="language-plaintext highlighter-rouge">http://your.server.ip:3000</code>. The default user and password is <code class="language-plaintext highlighter-rouge">admin / admin</code>.</p><p>Now you have to create a Prometheus data source:</p><ul><li>Click on the Grafana logo to open the sidebar.<li>Click on “Data Sources” in the sidebar.<li>Choose “Add New”.<li>Select “Prometheus” as the data source.<li>Set the Prometheus server URL (in our case: http://localhost:9090/)<li>Click “Add” to test the connection and to save the new data source.</ul><p>You can change the password of the Grafana from the Dashboard,</p><ul><li>Click on the user icon at the bottom of the dashboard<li>Click on Preference<li>Enter Old password and New password<li>Click change password</ul><p>To import the Grafana dashboard to the solution:</p><ul><li>On the Create tab, select Import. <a href="https://grafana.com/grafana/dashboards/405">Sample </a><li>Paste the ID (<code class="language-plaintext highlighter-rouge">405</code> ) of the dashboard you want to import and click Load.<li>Select the Data Source as Prometheus and click Import.</ul><p>Prometheus uses port <code class="language-plaintext highlighter-rouge">9090</code> and node_exporter uses port <code class="language-plaintext highlighter-rouge">9100</code> whereas Grafana uses port <code class="language-plaintext highlighter-rouge">3000</code>. ( We should whitelist the IP address of the Prometheus server with port 9100 in the <code class="language-plaintext highlighter-rouge">Security Group</code> )</p><p>For better visibility, we can set up an Nginx proxy.</p><p>Install Nginx.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo apt install nginx
cd /etc/nginx/sites-enabled
</pre></table></code></div></div><p>Create a new Nginx configuration for Prometheus</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vim prometheus.conf
</pre></table></code></div></div><p>And copy/paste the example below</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>server {
    listen 80;
    listen [::]:80;
    server_name  domain-name.com;

    auth_basic           	"Restricted Access!";
    auth_basic_user_file 	/etc/nginx/conf.d/.htpasswd; 


    location /grafana/ {
        auth_basic off;
        proxy_pass           http://localhost:3000/;
    }
  
    location /prometheus/ {
        proxy_pass http://127.0.0.1:9090/;
        }
}
</pre></table></code></div></div><p>Save and test the new configuration has no errors</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nginx -t
</pre></table></code></div></div><p>Restart Nginx</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo service nginx restart
sudo service nginx status
</pre></table></code></div></div><h5 id="to-configure-basic-authentication">To configure basic authentication:</h5><p>Install apache2-utils or httpd-tools</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>yum install httpd-tools		[RHEL/CentOS]
sudo apt install apache2-utils	[Debian/Ubuntu]
</pre></table></code></div></div><p>Next, run htpasswd command below to create the password file with the first user. The -c option is used to specify the passwd file, once you hit [Enter], you will be asked to enter the user password.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>htpasswd -c /etc/nginx/conf.d/.htpasswd admin
</pre></table></code></div></div><p>Now we have to make the following changes in the Grafana configuration file and in the Prometheus configuration file to work the Nginx proxy.</p><p>Add the following in the Grafan ini file</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>vim ​​/etc/grafana/grafana.ini


​​root_url = http://localhost:3000/grafana/ 
</pre></table></code></div></div><p>Add as following in the prometheus file</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>[Unit]
Description=Prometheus
After=network.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/ \
    --web.console.templates=/etc/prometheus/consoles \
    --web.console.libraries=/etc/prometheus/console_libraries \
    --web.external-url=http://domain-name.com/prometheus/ \
    --web.route-prefix="/"

[Install]
WantedBy=multi-user.target
</pre></table></code></div></div><p>Restart the services to make the changes in effect.</p><h5 id="to-install-ssl">To install SSL</h5><p>Install Certbot and it’s Nginx plugin with apt:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo apt install certbot python3-certbot-nginx
</pre></table></code></div></div><p>to obtain SSL,</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo certbot --nginx -d example.com -d www.example.com
</pre></table></code></div></div><p>Choose the option [2] Sample:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>Output
Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel):
</pre></table></code></div></div><p>That’s it!!!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/aws/'>AWS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/devops/" class="post-tag no-text-decoration" >devops</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How to install and configure Prometheus as well as Grafana for an EC2 instance? - Angel Mary Babu&url=https://angelmarybabu.github.io/posts/Prometheus-Grafana/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How to install and configure Prometheus as well as Grafana for an EC2 instance? - Angel Mary Babu&u=https://angelmarybabu.github.io/posts/Prometheus-Grafana/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=How to install and configure Prometheus as well as Grafana for an EC2 instance? - Angel Mary Babu&url=https://angelmarybabu.github.io/posts/Prometheus-Grafana/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/pods-stuck/">Pods stuck in ContainerCreating status - failed to assign an IP address to the container</a><li><a href="/posts/pods-stuck/">Pods stuck in ContainerCreating status - failed to assign an IP address to the container</a><li><a href="/posts/How-to-create-Persistent-Volume-in-EKS/">How to create Persistent Volume in EKS?</a><li><a href="/posts/eks-cluster-rancher/">How to add an EKS cluster in Rancher?</a><li><a href="/posts/argocd/">ArgoCD setup in EKS Cluster</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/amazon/">amazon</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/containerization/">containerization</a> <a class="post-tag" href="/tags/rancher/">rancher</a> <a class="post-tag" href="/tags/sysops/">sysops</a> <a class="post-tag" href="/tags/typography/">typography</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Self-Runner-in-EKS/"><div class="card-body"> <span class="timeago small" >Oct 11, 2020<i class="unloaded">2020-10-11T08:30:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Github Actions Self Runner in EKS</h3><div class="text-muted small"><p> Let’s create an EKS cluster, Create EKS using AWS CLI 1 2 3 4 5 6 aws eks create-cluster \ --region us-east-1 \ --name cluster-new \ --kubernetes-version 1.21 \ --role-arn arn:aws:iam...</p></div></div></a></div><div class="card"> <a href="/posts/velero-backup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T08:30:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Velero Backup for EKS</h3><div class="text-muted small"><p> Prerequisites AWS CLI needs to be configured in the machine where you execute Velero commands. Kubectl needs to be configured with the EKS cluster where you need to take the backup. Now we h...</p></div></div></a></div><div class="card"> <a href="/posts/argocd/"><div class="card-body"> <span class="timeago small" >Dec 15, 2021<i class="unloaded">2021-12-15T08:30:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ArgoCD setup in EKS Cluster</h3><div class="text-muted small"><p> ArgoCD is a gitops tool to perform the deployments in kubernetes environment and it consists of three main components. API Server Repository Server Application Controller Prerequisite Y...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/text-and-typography/" class="btn btn-outline-primary" prompt="Older"><p>Text and Typography</p></a> <a href="/posts/Self-Runner-in-EKS/" class="btn btn-outline-primary" prompt="Newer"><p>Github Actions Self Runner in EKS</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/AngelMaryBabu1">Angel Mary Babu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/amazon/">amazon</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/containerization/">containerization</a> <a class="post-tag" href="/tags/rancher/">rancher</a> <a class="post-tag" href="/tags/sysops/">sysops</a> <a class="post-tag" href="/tags/typography/">typography</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://angelmarybabu.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
